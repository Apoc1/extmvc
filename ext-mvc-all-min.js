ExtMVC=Ext.extend(Ext.util.Observable,{version:"0.6a1",constructor:function(){ExtMVC.superclass.constructor.apply(this,arguments);this.addEvents("environment-changed");this.getEnvSettings=this.getCurrentEnvironmentSettings},setup:function(A){this.app=new ExtMVC.App(A);this.name=this.app.name},controllers:{},registerController:function(A,B){this.controllers[A]=B},getController:function(A){var B=this.controllers[A];if(B){if(typeof B==="function"){this.controllers[A]=new this.controllers[A]()}return this.controllers[A]}else{return null}},currentEnvironment:"production",environments:{production:{}},setCurrentEnvironment:function(A){if(this.getEnvironmentSettings(A)){this.currentEnvironment=A;this.fireEvent("environment-changed",A,this.getEnvironmentSettings(A))}},getCurrentEnvironment:function(){return ExtMVC.currentEnvironment},getCurrentEnvironmentSettings:function(){return this.getEnvironmentSettings(this.getCurrentEnvironment())},addEnvironmentSettings:function(B,A){ExtMVC.environments[B]=ExtMVC.environments[B]||{};Ext.apply(ExtMVC.environments[B],A)},getEnvironmentSettings:function(A){A=A||ExtMVC.environment;return ExtMVC.environments[A]}});ExtMVC=new ExtMVC();Ext.ns("ExtMVC.Model","ExtMVC.plugin","ExtMVC.view","ExtMVC.view.scaffold","ExtMVC.lib");ExtMVC.App=Ext.extend(Ext.util.Observable,{constructor:function(A){ExtMVC.App.superclass.constructor.apply(this,arguments);Ext.apply(this,A||{});window[this.name]=this;this.initializeNamespaces();Ext.onReady(function(){if(this.fireEvent("before-launch",this)){this.initializeRouter();this.initializeEvents();if(this.usesHistory){this.initializeHistory()}this.launch();this.fireEvent("launched",this);if(this.usesHistory&&this.dispatchHistoryOnLoad){Ext.History.init(function(C){var B=document.location.hash.replace("#","");var D=this.router.recognise(B);if(D){this.dispatch(D)}},this)}else{Ext.History.init()}}},this)},name:"MyApp",usesHistory:false,dispatchHistoryOnLoad:true,launch:Ext.emptyFn,params:{},dispatch:function(B,C,A){var B=B||{};Ext.applyIf(B,{action:"index"});this.params=B;var E=ExtMVC.getController(B.controller);if(E!=undefined){var D=E[B.action];if(typeof D=="function"){D.apply(C||E,A||[])}else{throw new Error(String.format("Action '{0}' not found on Controller '{1}'",B.action,B.controller))}}},initializeRouter:function(){if(this.router){return}this.router=new ExtMVC.Router();ExtMVC.Router.defineRoutes(this.router)},name:undefined,initializeNamespaces:function(A){var A=A||this.name;if(A){Ext.ns(A,A+".controllers",A+".models",A+".views")}},initializeHistory:function(){this.historyForm=Ext.getBody().createChild({tag:"form",action:"#",cls:"x-hidden",id:"history-form",children:[{tag:"div",children:[{tag:"input",id:"x-history-field",type:"hidden"},{tag:"iframe",id:"x-history-frame"}]}]});Ext.History.on("change",this.onHistoryChange,this)},onHistoryChange:function(B){var A=this.router.recognise(B);if(A){this.dispatch(A,null,[{url:B}])}},initializeEvents:function(){this.addEvents("before-launch","launched")}});ExtMVC.Inflector={Inflections:{plural:[[(/(quiz)$/i),"$1zes"],[(/^(ox)$/i),"$1en"],[(/([m|l])ouse$/i),"$1ice"],[(/(matr|vert|ind)ix|ex$/i),"$1ices"],[(/(x|ch|ss|sh)$/i),"$1es"],[(/([^aeiouy]|qu)y$/i),"$1ies"],[(/(hive)$/i),"$1s"],[(/(?:([^f])fe|([lr])f)$/i),"$1$2ves"],[(/sis$/i),"ses"],[(/([ti])um$/i),"$1a"],[(/(buffal|tomat)o$/i),"$1oes"],[(/(bu)s$/i),"$1ses"],[(/(alias|status)$/i),"$1es"],[(/(octop|vir)us$/i),"$1i"],[(/(ax|test)is$/i),"$1es"],[(/s$/i),"s"],[(/$/),"s"]],singular:[[(/(quiz)zes$/i),"$1"],[(/(matr)ices$/i),"$1ix"],[(/(vert|ind)ices$/i),"$1ex"],[(/^(ox)en/i),"$1"],[(/(alias|status)es$/i),"$1"],[(/(octop|vir)i$/i),"$1us"],[(/(cris|ax|test)es$/i),"$1is"],[(/(shoe)s$/i),"$1"],[(/(o)es$/i),"$1"],[(/(bus)es$/i),"$1"],[(/([m|l])ice$/i),"$1ouse"],[(/(x|ch|ss|sh)es$/i),"$1"],[(/(m)ovies$/i),"$1ovie"],[(/(s)eries$/i),"$1eries"],[(/([^aeiouy]|qu)ies$/i),"$1y"],[(/([lr])ves$/i),"$1f"],[(/(tive)s$/i),"$1"],[(/(hive)s$/i),"$1"],[(/([^f])ves$/i),"$1fe"],[(/(^analy)ses$/i),"$1sis"],[(/((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)ses$/i),"$1$2sis"],[(/([ti])a$/i),"$1um"],[(/(n)ews$/i),"$1ews"],[(/s$/i),""]],irregular:[["move","moves"],["sex","sexes"],["child","children"],["man","men"],["person","people"]],uncountable:["sheep","fish","series","species","money","rice","information","equipment"]},ordinalize:function(A){if(11<=parseInt(A,10)%100&&parseInt(A,10)%100<=13){return A+"th"}else{switch(parseInt(A,10)%10){case 1:return A+"st";case 2:return A+"nd";case 3:return A+"rd";default:return A+"th"}}},pluralize:function(C){var E=ExtMVC.Inflector.uncountableOrIrregular(C);if(E){return E}for(var A=0;A<ExtMVC.Inflector.Inflections.plural.length;A++){var B=ExtMVC.Inflector.Inflections.plural[A][0];var D=ExtMVC.Inflector.Inflections.plural[A][1];if(B.test(C)){return C.replace(B,D)}}return C},singularize:function(C){var E=ExtMVC.Inflector.uncountableOrIrregular(C);if(E){return E}for(var A=0;A<ExtMVC.Inflector.Inflections.singular.length;A++){var B=ExtMVC.Inflector.Inflections.singular[A][0];var D=ExtMVC.Inflector.Inflections.singular[A][1];if(B.test(C)){return C.replace(B,D)}}return C},uncountableOrIrregular:function(E){for(var C=0;C<ExtMVC.Inflector.Inflections.uncountable.length;C++){var B=ExtMVC.Inflector.Inflections.uncountable[C];if(E.toLowerCase==B){return B}}for(var C=0;C<ExtMVC.Inflector.Inflections.irregular.length;C++){var D=ExtMVC.Inflector.Inflections.irregular[C][0];var A=ExtMVC.Inflector.Inflections.irregular[C][1];if((E.toLowerCase==D)||(E==A)){return A}}return false}};Array.prototype.toSentence=function(A){A=A||"and";var C="";if(this.length<=1){C=this[0]}else{var B=this.slice(0,this.length-1);C=String.format("{0} {1} {2}",B.join(", "),A,this[this.length-1])}return C};String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.substr(1).toLowerCase()};String.prototype.titleize=function(){return this.replace(/\w\S*/g,function(A){return A.charAt(0).toUpperCase()+A.substr(1).toLowerCase()})};String.prototype.camelize=function(){return this.replace(/_/g," ").titleize().replace(/ /g,"")};String.prototype.underscore=function(){return this.replace(/([A-Z])/g,"_$1").toLowerCase().replace(/ /g,"_").replace(/^_/,"")};String.prototype.singularize=function(){return ExtMVC.Inflector.singularize(this)};String.prototype.pluralize=function(){return ExtMVC.Inflector.pluralize(this)};String.prototype.humanize=function(){return this.underscore().replace(/_/g," ")};String.prototype.escapeHTML=function(){return this.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")};String.prototype.toCurrency=function(H){if(typeof(H)=="undefined"){var H="$"}var B=this.split(".")[0],F=this.split(".")[1];var A=Math.floor(B.length/3);var E=B.length%3,G=E;var C=E==0?[]:[B.substr(0,E)];for(var D=0;D<A;D++){C.push(B.substr(E+(D*3),3))}B=H+C.join(",");return F?String.format("{0}.{1}",B,F):B};ExtMVC.Router=function(){};ExtMVC.Router.prototype={mappings:[],namedRoutes:{},connect:function(B,C){var A=new ExtMVC.Route(B,C);this.mappings.push(A);return A},name:function(A,B,C){this.namedRoutes[A]=this.connect(B,C)},root:function(A){var A=A||{};this.connect("",Ext.applyIf(A,{action:"index"}))},resources:function(A,I){if(arguments[1]&&typeof(arguments[1])=="string"){var H=arguments[arguments.length-1];var B=(typeof(H)=="object")?H:{};for(var C=0;C<arguments.length;C++){if(!(H===arguments[C]&&typeof(H)=="object")){this.resources(arguments[C],B)}}return}var G=String.format("{0}_path",A.pluralize());var E=String.format("new_{0}_path",A.singularize());var F=String.format("{0}_path",A.singularize());var D=String.format("edit_{0}_path",A.singularize());this.name(G,A,Ext.apply({},{controller:A,action:"index"}));this.name(E,A+"/new",Ext.apply({},{controller:A,action:"new"}));this.name(F,A+"/:id",Ext.apply({},{controller:A,action:"show",conditions:{":id":"[0-9]+"}}));this.name(D,A+"/:id/edit",Ext.apply({},{controller:A,action:"edit",conditions:{":id":"[0-9]+"}}))},redirectTo:function(){var A=this.urlFor.apply(this,arguments);if(A){Ext.History.add(A);return true}else{return false}},linkTo:function(B,A){var A=A||{};var C=this.urlFor(B);if(C){return Ext.applyIf(A,{url:C,cls:[B.controller,B.action,B.id].join("-").replace("--","-").replace(/-$/,""),text:this.constructDefaultLinkToName(B,A),handler:function(){Ext.History.add(C)}})}else{throw new Error("No match for that url specification")}},constructDefaultLinkToName:function(B,A){if(!B||!B.controller||!B.action){return""}var A=A||{};Ext.applyIf(A,{singularName:B.controller.singularize()});var C=B.action.titleize();if(C=="Index"){return"Show "+B.controller.titleize()}else{return C+" "+A.singularName.titleize()}},recognise:function(C){for(var D=0;D<this.mappings.length;D++){var A=this.mappings[D];var B=A.matchesFor(C);if(B){return B}}return false},urlFor:function(D,B){var A;if(typeof(D)=="string"){if(A=this.namedRoutes[D]){var B=B||{};if(typeof(B)=="number"){B={id:B}}if(B.data&&B.data.id){B={id:B.data.id}}return A.urlForNamed(B)}}else{for(var E=0;E<this.mappings.length;E++){A=this.mappings[E];var C=A.urlFor(D);if(C){return C}}}return false},withOptions:function(B,A){var B=B||{};var D=this;var C={};C.prototype=this;Ext.apply(C,{connect:function(E,F){var F=F||{};Ext.applyIf(F,B);D.connect.call(D,E,F)},name:function(E,F,G){var G=G||{};Ext.applyIf(G,B);D.name.call(D,E,F,G)}});A.call(this,C)}};ExtMVC.Router.defineRoutes=function(A){A.connect(":controller/:action");A.connect(":controller/:action/:id")};ExtMVC.Route=function(C,A){this.mappingString=C;this.options=A||{};this.paramMatchingRegex=new RegExp(/:([0-9A-Za-z\_]*)/g);this.paramsInMatchString=this.mappingString.match(this.paramMatchingRegex)||[];this.paramsInStringWithOptions=[];this.conditions=this.options.conditions||{};if(this.options.conditions){delete this.options.conditions}for(var B=0;B<this.paramsInMatchString.length;B++){this.paramsInStringWithOptions.push(this.paramsInMatchString[B])}for(var D in A){this.paramsInStringWithOptions.push(":"+D)}this.matcherRegex=this.convertToUsableRegex(C)};ExtMVC.Route.prototype={recognises:function(A){return this.matcherRegex.test(A)},matchesFor:function(B){if(!this.recognises(B)){return false}var E={};var D=this.paramsInMatchString;var A=B.match(this.matcherRegex);A.shift();for(var C=D.length-1;C>=0;C--){E[D[C].replace(":","")]=A[C]}for(option in this.options){E[option]=this.options[option]}return E},urlForNamed:function(A){var A=A||{};return this.urlFor(Ext.applyIf(A,this.options))},urlFor:function(C){var B=this.mappingString;for(var F in C){if(C[F]&&this.options[F]&&C[F]!=this.options[F]){return false}}var E=[];for(var F in C){E.push(":"+F)}E=E.sort();var A=this.paramsInStringWithOptions.sort();if(A.length!=E.length){return false}for(var D=0;D<E.length;D++){if(E[D]!=A[D]){return false}}for(var F in C){B=B.replace(":"+F,C[F])}return B},convertToUsableRegex:function(A){var E=this.paramsInMatchString;for(var B=E.length-1;B>=0;B--){var C=this.conditions[E[B]];var D=String.format("({0})",C||"[a-zA-Z0-9_,]+");A=A.replace(new RegExp(E[B]),D)}return new RegExp("^"+A+"$")}};ExtMVC.lib.Dependencies=Ext.extend(Ext.util.Observable,{constructor:function(){this.dependencies={};ExtMVC.lib.Dependencies.superclass.constructor.apply(this,arguments)},get:function(A){return this.dependencies[A]||[]},add:function(D,C,B){var A=this.dependencies[D]||[];A.push({name:C,config:B});this.dependencies[D]=A}});ExtMVC.Controller=Ext.extend(Ext.util.Observable,{name:null,onExtended:function(){if(this.name!=null){this.viewsPackage=Ext.ns(String.format("{0}.views.{1}",ExtMVC.name,this.name));ExtMVC.registerController(this.name,this.constructor)}},constructor:function(A){ExtMVC.Controller.superclass.constructor.apply(this,arguments);Ext.apply(this,A||{});this.initEvents();this.initListeners()},initEvents:Ext.emptyFn,initListeners:Ext.emptyFn,getViewClass:function(A){return this.viewsPackage[A]},addTo:null,render:function(D,B){var C=this.getViewClass(D);if(typeof C=="function"){var A=new C(B);if(this.addTo){this.renderViaAddTo(A)}return A}else{throw new Error(String.format("View '{0}' not found",D))}},renderViaAddTo:function(A){if(this.addTo!=undefined){this.addTo.removeAll();this.addTo.doLayout();this.addTo.add(A);this.addTo.doLayout()}}});Ext.reg("controller",ExtMVC.Controller);ExtMVC.CrudController=Ext.extend(ExtMVC.Controller,{model:null,create:function(C,B){var A=new this.model(C);A.save({scope:this,success:function(D){this.fireEvent("create",D)},failure:function(D){this.fireEvent("create-failed",D)}})},read:function(A){this.model.findById(A,{scope:this,success:function(B){this.fireEvent("read",B)},failure:function(){this.fireEvent("read-failed",A)}})},update:function(A,C){for(var B in C){A.set(B,C[B])}A.save({scope:this,success:function(){this.fireEvent("update",A,C)},failure:function(){this.fireEvent("update-failed",A,C)}})},destroy:function(A){A.destroy({scope:this,success:function(){this.fireEvent("delete",A)},failure:function(){this.fireEvent("delete-failed",A)}})},index:function(){this.render("Index",{model:this.model,controller:this,listeners:{scope:this,"delete":this.destroy,add:this.build,edit:this.edit}})},build:function(){this.render("New",{model:this.model,listeners:{scope:this,cancel:this.index,save:this.create},viewsPackage:this.viewsPackage})},edit:function(A){this.render("Edit",{model:this.model,listeners:{scope:this,cancel:this.index,save:this.update},viewsPackage:this.viewsPackage}).loadRecord(A)},initEvents:function(){this.addEvents("create","create-failed","read","read-failed","update","update-failed","delete","delete-failed","index","index-failed")},getViewClass:function(B){var A=ExtMVC.CrudController.superclass.getViewClass.call(this,B);return(A==undefined)?this.scaffoldViewName(B):A},scaffoldViewName:function(A){return ExtMVC.view.scaffold[A.titleize()]}});Ext.ns("ExtMVC.plugin.CrudController");(function(){var A=ExtMVC.plugin.CrudController;A.registerActions=function(B,C){Ext.apply(this,C,A.defaultFunctions);this.addEvents("findsuccess","findfailure");this.model=B;if(!this.model){throw new Error("You must provide a model to this.actsAsCrudController().  Pass it as the first argument to actsAsCrudController or set 'this.model = YourModel' before calling actsAsCrudController.")}this.registerAction("new",function(){this.form=this.renderView("new")},{overwrite:false});this.registerAction("edit",function(){this.form=this.renderView("edit");this.form.el.mask("Loading...","x-mask-loading");this.loadForm(this.form)},{overwrite:false});this.registerAction("create",function(D){D.el.mask("Saving...","x-mask-loading");this.onCreate(D)},{overwrite:false});this.registerAction("update",function(D){D.el.mask("Saving...","x-mask-loading");this.onUpdate(D)},{overwrite:false});this.registerAction("delete",function(F,D){var F=F||this.os.params.id;if(F){var E=new this.model({id:F});E.destroy({scope:this,success:this.ondeleteSuccess.createDelegate(this,[D]),failure:this.ondeleteFailure})}},{overwrite:false})};A.defaultFunctions={modelObj:null,loadUrl:null,saveUrl:null,loadForm:function(B){this.model.findById(this.os.params.id,{scope:this,url:this.loadUrl,success:this.onFindSuccess,failure:this.onFindFailure,callback:B.el.unmask.createDelegate(B.el)})},onFindSuccess:function(B){this.editModelObj=B;this.form.getForm().loadRecord(B);this.fireEvent("findsuccess",B)},onFindFailure:function(){this.fireEvent("findfailure");Ext.Msg.show({title:"Load Failed",msg:"The item could not be loaded",buttons:{yes:"Try again",no:"Back"},scope:this,fn:function(B){B=="yes"?this.loadForm():Ext.History.back()}})},onCreate:function(B){this.newModelObj=new this.model({});this.onSave(B,this.newModelObj,{success:this.onCreateSuccess,failure:this.onCreateFailure})},onUpdate:function(B){this.onSave(B,this.editModelObj,{success:this.onUpdateSuccess,failure:this.onUpdateFailure})},onSave:function(D,C,B){D.el.mask("Saving...","x-mask-loading");C.update(D.getValues(),Ext.apply({},B,{scope:this,url:this.saveUrl,callback:function(){D.el.unmask()}}))},onSaveSuccess:function(B){this.os.router.redirectTo(Ext.apply({},{action:"index"},this.os.params))},onCreateSuccess:function(){this.onSaveSuccess()},onUpdateSuccess:function(){this.onSaveSuccess()},onCreateFailure:function(C,B){this.addErrorMessages(C,B)},onUpdateFailure:function(C,B){this.addErrorMessages(C,B)},addErrorMessages:function(C,B){this.form.getForm().clearInvalid();this.form.getForm().markInvalid(C.errors.forForm())},ondeleteSuccess:function(B){if(B){B.reload()}},ondeleteFailure:function(B){Ext.Msg.alert("Delete Failed","Sorry, something went wrong when trying to delete that item.  Please try again")}};ExtMVC.Controller.prototype.actsAsCrudController=A.registerActions})();ExtMVC.OS=function(A){ExtMVC.OS.superclass.constructor.call(this,A);this.addEvents("beforelaunch","launch");this.initialiseNamespaces();var B=this;ExtMVC.OS.getOS=function(){return B}};Ext.extend(ExtMVC.OS,ExtMVC.Controller,{registerController:function(A,B){this.controllers[A]=B},getController:function(A){var B=this.controllers[A];if(B){if(typeof B==="function"){this.controllers[A]=new this.controllers[A]()}return this.controllers[A]}else{return null}},controllers:{},launch:function(){if(this.fireEvent("beforelaunch",this)){this.initializeRouter();this.initializeViewport();if(this.usesHistory){this.initialiseHistory()}this.onLaunch();this.fireEvent("launch",this)}},usesHistory:false,dispatchHistoryOnLoad:true,viewportBuilder:"leftmenu",viewportBuilderConfig:{},initializeViewport:function(){var A=ExtMVC.ViewportBuilderManager.find(this.viewportBuilder);if(A){A.build(this)}},params:{},dispatch:function(B,C,A){var B=B||{};Ext.applyIf(B,{action:"index"});this.params=B;var D;if(D=this.getController(B.controller)){D.fireAction(B.action,C||D,A||[])}},onLaunch:Ext.emptyFn,initializeRouter:function(){if(this.router){return}this.router=new ExtMVC.Router();ExtMVC.Router.defineRoutes(this.router)},name:undefined,initialiseNamespaces:function(A){var A=A||this.name;if(A){Ext.ns(A,A+".controllers",A+".models",A+".views")}},initialiseHistory:function(){this.historyForm=Ext.getBody().createChild({tag:"form",action:"#",cls:"x-hidden",id:"history-form",children:[{tag:"div",children:[{tag:"input",id:"x-history-field",type:"hidden"},{tag:"iframe",id:"x-history-frame"}]}]});if(this.dispatchHistoryOnLoad){Ext.History.init(function(B){var A=document.location.hash.replace("#","");var C=this.router.recognise(A);if(C){this.dispatch(C)}},this)}else{Ext.History.init()}Ext.History.on("change",this.handleHistoryChange,this)},handleHistoryChange:function(B){var A=this.router.recognise(B);if(A){this.dispatch(A,null,[{url:B}])}},setsTitle:function(A,B){var B=B||A.title||A.initialConfig?A.initialConfig.title:null;if(B){A.on("show",function(){document.title=B});A.on("activate",function(){document.title=B})}}});Ext.reg("os",ExtMVC.OS);ExtMVC.Model=function(){return{pendingCreation:{},getModelsPendingDefinitionOf:function(A){return this.pendingCreation[A]||[]},setModelPendingDefinitionOf:function(B,D,C){var A=this.pendingCreation[B]||[];A.push({name:D,config:C});this.pendingCreation[B]=A},strictMode:false,modelNamespace:window,define:function(A,B){var D=true,B=B||{};if(typeof B.extend!="undefined"){var C=this.modelNamespace[B.extend];if(typeof C=="undefined"){D=false;this.setModelPendingDefinitionOf(B.extend,A,B)}}if(D){this.create.apply(this,arguments)}},create:function(B,D){D=D||{};if(this.isAlreadyDefined(B)){if(this.strictMode){throw new Error(B+" is already defined")}return false}var E=this.modelNamespace[D.extend];var A=this.buildFields(D.fields,E);delete D.fields;var C=this.modelNamespace[B]=Ext.data.Record.create(A);var F=D.classMethods||{};delete D.classMethods;Ext.apply(C.prototype,D);if(typeof E!="undefined"){Ext.applyIf(F,E);Ext.applyIf(C.prototype,E.prototype)}C.prototype.modelName=B;this.setupNames(C);for(methodName in F){if(methodName!="prototype"){C[methodName]=F[methodName]}}this.initializePlugins(C);this.afterCreate(B)},afterCreate:function(A){var B=this.getModelsPendingDefinitionOf(A);if(B){Ext.each(B,function(C){this.create(C.name,C.config)},this)}},isAlreadyDefined:function(A){if(typeof this.modelNamespace[A]!="undefined"){return true}var C=false;for(superclass in this.pendingCreation){var B=this.pendingCreation[superclass];Ext.each(B,function(D){if(D.name==A){C=true}},this)}return C},buildFields:function(B,C){B=B||[];var A=new Ext.util.MixedCollection(false,function(D){return D.name});A.addAll(B);if(typeof C!="undefined"){C.prototype.fields.each(function(D){if(typeof A.get(D.name)=="undefined"){A.add(D)}})}return A.items},setupNames:function(A){var C=A.prototype,B=ExtMVC.Inflector;Ext.applyIf(A.prototype,{tableName:B.pluralize(C.modelName.underscore()),foreignKeyName:B.singularize(C.modelName.underscore())+"_id",singularHumanName:C.modelName.humanize().titleize(),pluralHumanName:B.pluralize(C.modelName.humanize().titleize())})},plugins:[],addPlugin:function(A){this.plugins.push(A)},initializePlugins:function(A){Ext.each(this.plugins,function(B){B.initialize(A)},this)}}}();Ext.ns("ExtMVC.Model.plugin");ExtMVC.Model.Base=function(){};ExtMVC.Model.Base.prototype={primaryKey:"id",newRecord:function(){var A=this.get(this.primaryKey);return typeof A=="undefined"||A==""},MVCModelId:function(){return String.format("{0}-{1}",this.tableName,this.get(this.primaryKey))},getReader:function(){if(!this.reader){this.reader=new Ext.data.JsonReader({totalProperty:"results",root:this.tableName},this.constructor)}return this.reader},initialize:Ext.emptyFn};Ext.apply(Ext.data.Record.prototype,new ExtMVC.Model.Base());(function(){ExtMVC.Model.plugin.association=(function(){return{initialize:function(A){var C=A.prototype,D=ExtMVC.Model.plugin.association;this.resolveDependencies(A);if(C.hasMany){Ext.each(this.parseParams(C.hasMany,"HasMany"),function(E){this.define(D.HasMany,A,E)},this)}if(C.belongsTo){Ext.each(this.parseParams(C.belongsTo,"BelongsTo"),function(E){this.define(D.BelongsTo,A,E)},this)}},dependencies:new ExtMVC.lib.Dependencies(),define:function(F,D,G){var E=ExtMVC.Model.modelNamespace,C=G.associatedClass,A=D.prototype.modelName;if(typeof E[C]=="function"){this.create.call(this,F,A,G)}else{G.associationConstructor=F;this.dependencies.add(C,A,G)}},create:function(F,C,G){var E=ExtMVC.Model.modelNamespace,D=E[C],H=E[G.associatedClass],A=G.associationName;D.prototype[A]=new F(D,H,G)},resolveDependencies:function(A){var C=this.dependencies.get(A.prototype.modelName);Ext.each(C||[],function(E){var D=E.config.associationConstructor;delete E.config.associationConstructor;this.create(D,E.name,E.config)},this)},parseParams:function(F,C){var D=[],C=C||"BelongsTo",A=C=="BelongsTo"?"singularize":"pluralize";if(Ext.isArray(F)){Ext.each(F,function(H){D.concat(this.parseParams(H))},this);return D}else{if(typeof F=="string"){F={associatedClass:F}}var G=F.associatedClass,E=typeof G=="function"?ExtMVC.Inflector[A](G.prototype.modelName):ExtMVC.Inflector[A](G);Ext.applyIf(F,{extend:{},associationName:E});D.push(F)}return D}}})();var B=ExtMVC.Model.plugin.association;B.Base=function(A,D,C){C=C||{};this.ownerClass=A;this.associatedClass=D;Ext.apply(this,C.extend||{});this.initialConfig=C;this.initialize()};B.Base.prototype={initialize:Ext.emptyFn};B.BelongsTo=Ext.extend(B.Base,{initialize:function(){Ext.apply(this,{name:ExtMVC.Inflector.singularize(this.associatedClass.prototype.tableName),foreignKey:this.associatedClass.prototype.foreignKeyName})}});B.HasMany=Ext.extend(B.Base,{initialize:function(){Ext.apply(this,{name:this.associatedClass.prototype.tableName,foreignKey:this.ownerClass.prototype.foreignKeyName})}})})();ExtMVC.Model.addPlugin(ExtMVC.Model.plugin.association);ExtMVC.Model.plugin.adapter=(function(){return{initialize:function(B){var A=new this.RESTJSONAdapter();Ext.override(Ext.data.Record,A.instanceMethods());Ext.apply(B,A.classMethods());try{Ext.override(ExtMVC.Model.plugin.association.HasMany,A.hasManyAssociationMethods());Ext.override(ExtMVC.Model.plugin.association.BelongsTo,A.belongsToAssociationMethods())}catch(C){}}}})();ExtMVC.Model.addPlugin(ExtMVC.Model.plugin.adapter);ExtMVC.Model.plugin.adapter.Abstract=function(A){};ExtMVC.Model.plugin.adapter.Abstract.prototype={doSave:Ext.emptyFn,doFind:Ext.emptyFn,doDestroy:Ext.emptyFn,instanceMethods:function(){return{adapter:this,save:function(A){A=A||{};if(A.skipValidation===true||this.isValid()){return this.adapter.doSave(this,A)}else{if(typeof A.failure=="function"){return A.failure.call(A.scope||this,A)}}},destroy:function(A){return this.adapter.doDestroy(this,A)},update:function(B,A){this.setValues(B);this.save(A)},loaded:function(){}}},classMethods:function(){return{adapter:this,create:function(C,B){var A=new this(C);A.save(B);return A},build:function(A){return new this(A)},find:function(B,A){if(typeof(B)=="number"){B={primaryKey:B}}return this.adapter.doFind(B,A,this)},destroy:function(B,A){return this.adapter.doDestroy(B,A)}}},hasManyAssociationMethods:function(){return{adapter:this,create:function(C,B){var A=new this.associatedClass(C)},build:function(B,A){},find:function(A){},loaded:function(){},destroy:function(A){}}},belongsToAssociationMethods:function(){return{adapter:this,find:function(A){},loaded:function(){},destroy:function(A){}}}};ExtMVC.Model.plugin.adapter.RESTAdapter=Ext.extend(ExtMVC.Model.plugin.adapter.Abstract,{createMethod:"POST",readMethod:"GET",updateMethod:"PUT",destroyMethod:"DELETE",doSave:function(A,B){if(typeof A=="undefined"){throw new Error("No instance provided to REST Adapter save")}B=B||{};Ext.Ajax.request(Ext.applyIf(B,{url:this.instanceUrl(A),method:A.newRecord()?this.createMethod:this.updateMethod,params:this.buildPostData(A)}))},doFind:function(F,D,E){F=F||{};D=D||{};var C=this.findUrl(F,E);var H=D.callback,A=D.success,G=D.failure;delete D.callback;delete D.success;delete D.failure;var B=function(J,I){if(typeof J=="function"){J.apply(D.scope,I)}};Ext.applyIf(D,{method:this.readMethod,scope:this,proxy:new Ext.data.HttpProxy({url:C,headers:{"Content-Type":"application/json"}})});if(F.primaryKey==undefined){return new Ext.data.Store(Ext.applyIf(D,{autoLoad:true,remoteSort:false,reader:E.prototype.getReader()}))}else{Ext.applyIf(D,{params:F});Ext.Ajax.request(Ext.apply(D,{callback:function(K,L,J){if(L===true){var I=new E(J.responseText);B(A,[I,K,J])}else{B(G,arguments)}B(H,arguments)}}))}},doDestroy:function(A,B){if(typeof A=="undefined"){throw new Error("No instance provided to REST Adapter save")}B=B||{};Ext.Ajax.request(Ext.applyIf(B,{method:this.destroyMethod,url:this.instanceUrl(A)}))},instanceUrl:function(A){if(A.newRecord()){return String.format("/{0}",A.tableName)}else{return String.format("/{0}/{1}",A.tableName,A.get(A.primaryKey))}},collectionUrl:function(A){return String.format("/{0}",A.prototype.tableName)},buildPostData:function(A){var C={},B=A.modelName.underscore();for(key in A.data){C[B+"["+key+"]"]=A.data[key]}return C},findUrl:function(C,B){if(typeof(C)=="object"&&C.primaryKey){var A=new B({});A.set(A.primaryKey,C.primaryKey);delete C.primaryKey;return this.instanceUrl(A)}else{return this.collectionUrl(B)}}});ExtMVC.Model.plugin.adapter.RESTJSONAdapter=Ext.extend(ExtMVC.Model.plugin.adapter.RESTAdapter,{doSave:function(A,B){if(typeof A=="undefined"){throw new Error("No instance provided to REST Adapter save")}B=B||{};Ext.Ajax.request(Ext.applyIf(B,{url:this.instanceUrl(A),method:A.newRecord()?this.createMethod:this.updateMethod,jsonData:A.data,headers:{"Content-Type":"application/json"}}))}});Ext.ns("ExtMVC.Model.validation");(function(){var A=ExtMVC.Model.validation;A.AbstractValidation=function(B,D,C){this.ownerClass=B;this.field=D;Ext.apply(this,C)};A.AbstractValidation.prototype={getValue:function(B){return B.get(this.field)},isValid:function(B){return true}};A.ValidatesPresenceOf=Ext.extend(A.AbstractValidation,{message:"must be present",isValid:function(B){var D=this.getValue(B),C=false;switch(typeof D){case"object":if(D!=null){C=true}break;case"string":if(D.length!=0){C=true}break}return C}});A.ValidatesLengthOf=Ext.extend(A.AbstractValidation,{tooShortMessage:"is too short",tooLongMessage:"is too long",message:"",isValid:function(B){var C=this.getValue(B);if(typeof C=="undefined"){return true}if(this.minimum&&C.length<this.minimum){this.message=this.tooShortMessage;return false}if(this.maximum&C.length>this.maximum){this.message=this.tooLongMessage;return false}return true}});A.ValidatesNumericalityOf=Ext.extend(A.AbstractValidation,{message:"must be a number",isValid:function(B){return"number"==typeof this.getValue(B)}});A.ValidatesInclusionOf=Ext.extend(A.AbstractValidation,{constructor:function(B,D,C){C=C||{};Ext.applyIf(C,{allowed:[]});A.ValidatesInclusionOf.superclass.constructor.call(this,B,D,C);Ext.applyIf(this,{message:"must be one of "+this.allowed.toSentence("or")})},isValid:function(B){var D=this.getValue(B);for(var C=0;C<this.allowed.length;C++){if(this.allowed[C]==D){return true}}return false}});A.ValidatesExclusionOf=Ext.extend(A.AbstractValidation,{constructor:function(B,D,C){C=C||{};Ext.applyIf(C,{disallowed:[]});A.ValidatesExclusionOf.superclass.constructor.call(this,B,D,C);Ext.applyIf(this,{message:"must not be "+this.disallowed.toSentence("or")})},isValid:function(B){var E=this.getValue(B),D=true;for(var C=0;C<this.disallowed.length;C++){if(this.disallowed[C]==E){D=false}}return D}});A.ValidatesFormatOf=Ext.extend(A.AbstractValidation,{message:"is invalid",isValid:function(B){return this.regex.test(this.getValue(B))}})})();ExtMVC.Model.validation.Errors=function(){this.all={}};ExtMVC.Model.validation.Errors.prototype={forForm:function(){var A={};for(key in this.all){A[key]=this.forField(key,true)}return A},multipleErrorConnector:"and",clear:function(){this.all={}},add:function(B,A){this.all[B]=this.all[B]||[];this.all[B].push(A)},forField:function(C,B){B=B||false;var A=this.all[C]||[];return B?A.toSentence(this.multipleErrorConnector):A},isValid:function(A){for(key in this.all){return false}return true},readServerErrors:function(A,C){var A=A||{};if(C!==true){this.clearErrors()}if(typeof(A)=="string"){A=Ext.decode(A)}var D=A.errors;if(D){for(var B=0;B<D.length;B++){this.all.push(D[B])}}}};Ext.ns("ExtMVC.Model.validation");(function(){var A=ExtMVC.Model.validation;Ext.apply(Ext.data.Record.prototype,{isValid:function(){if(this.validations){if(!this.errors){this.errors=new ExtMVC.Model.validations.Errors()}this.errors.clear();Ext.each(this.validations,function(B){if(!B.isValid(this)){this.errors.add(B.field,B.message)}},this)}return this.errors.isValid()}});(function(){var E=Ext.data.Record.prototype,B=Ext.data.Record,D={};for(var C in Ext.data.Record){D[C]=Ext.data.Record[C]}Ext.data.Record=function(F,G){B.apply(this,arguments);this.errors=new ExtMVC.Model.validation.Errors()};for(var C in D){Ext.data.Record[C]=D[C]}})();A.Plugin={initialize:function(B){this.model=B;Ext.apply(B.prototype,{validations:this.parseValidations()})},parseValidations:function(){var D=[];for(var C in ExtMVC.Model.validation){if(/^validate/.test(C.toLowerCase())){for(var E in this.model.prototype){if(E.toLowerCase()==C.toLowerCase()){var F=ExtMVC.Model.validation[C],B=this.model.prototype[E];if(!Ext.isArray(B)){B=[B]}Ext.each(B,function(G){D.push(this.buildValidation(F,G))},this)}}}}return D},buildValidation:function(B,D){var E,C={};if("string"==typeof D){E=D}else{E=D.field;delete D.field;C=D}return new B(this.model,E,C)}};ExtMVC.Model.addPlugin(A.Plugin)})();ExtMVC.ViewportBuilderManager={viewportBuilders:{},register:function(A,B){this.viewportBuilders[A]=B},find:function(B,A){var C=this.viewportBuilders[B];if(C){return new C(A)}}};ExtMVC.ViewportBuilder=function(A){this.initialConfig=A};ExtMVC.ViewportBuilder.prototype={build:Ext.emptyFn};ExtMVC.view.scaffold.ScaffoldFormPanel=Ext.extend(Ext.form.FormPanel,{constructor:function(A){var A=A||{};this.model=A.model;if(this.model==undefined){throw new Error("No model supplied to scaffold Form view")}ExtMVC.view.scaffold.ScaffoldFormPanel.superclass.constructor.call(this,A)},initComponent:function(){Ext.applyIf(this,{autoScroll:true,items:this.buildItems(),keys:[{key:Ext.EventObject.ESC,scope:this,handler:this.onCancel},{key:"s",ctrl:true,scope:this,stopEvent:true,handler:this.onSave}],buttons:[{text:"Save",scope:this,iconCls:"save",handler:this.onSave},{text:"Cancel",scope:this,iconCls:"cancel",handler:this.onCancel}]});ExtMVC.view.scaffold.ScaffoldFormPanel.superclass.initComponent.apply(this,arguments)},formItemConfig:{anchor:"-40",xtype:"textfield"},ignoreFields:["id","created_at","updated_at"],buildItems:function(){items=[];if(this.viewsPackage&&this.viewsPackage.FormFields){items=this.viewsPackage.FormFields}else{var B=this.model,D=B.prototype,A=D.fields;A.each(function(E){if(this.ignoreFields.indexOf(E.name)==-1){items.push(Ext.applyIf({name:E.name,fieldLabel:(E.name.replace(/_/g," ")).capitalize()}))}},this)}for(var C=0;C<items.length;C++){Ext.applyIf(items[C],this.formItemConfig)}return items},onSave:function(){this.fireEvent("save",this.getForm().getValues())},onCancel:function(){this.fireEvent("cancel")}});Ext.reg("scaffold_form_panel",ExtMVC.view.scaffold.ScaffoldFormPanel);ExtMVC.view.scaffold.Index=Ext.extend(Ext.grid.GridPanel,{constructor:function(A){A=A||{};this.model=A.model;if(this.model==undefined){throw new Error("No model supplied to scaffold Index view")}this.controller=this.controller||A.controller;A.columns=A.columns||this.buildColumns(this.model);A.store=A.store||this.model.find();var B=this.hasTopToolbar?this.buildTopToolbar():null;var C=this.hasBottomToolbar?this.buildBottomToolbar(A.store):null;Ext.applyIf(A,{title:this.getTitle(),viewConfig:{forceFit:true},id:String.format("{0}_index",this.model.prototype.tableName),loadMask:true,tbar:B,bbar:C,keys:[{key:"a",scope:this,handler:this.onAdd},{key:"e",scope:this,handler:this.onEdit},{key:Ext.EventObject.DELETE,scope:this,handler:this.onDelete}]});ExtMVC.view.scaffold.Index.superclass.constructor.call(this,A);this.initEvents();this.initListeners()},initEvents:function(){this.addEvents("edit","add","delete")},initListeners:function(){this.on({scope:this,dblclick:this.onEdit});if(this.controller){this.controller.on({scope:this,"delete":function(){this.store.reload()}})}},getTitle:function(){return String.format("Showing {0}",this.model.prototype.pluralHumanName)},preferredColumns:["id","title","name","first_name","last_name","login","username","email","email_address","content","message","body"],ignoreColumns:["password","password_confirmation"],narrowColumns:["id"],wideColumns:["message","content","description","bio","body"],hasTopToolbar:true,hasBottomToolbar:true,buildColumns:function(C){var C=this.model,G=C.prototype,A=G.fields,E=[];wideColumns=[];A.each(function(H){if(this.preferredColumns.indexOf(H.name)>-1){E.push(this.buildColumn(H.name))}},this);A.each(function(H){if(this.preferredColumns.indexOf(H.name)==-1&&this.ignoreColumns.indexOf(f.name)==-1){E.push(this.buildColumn(H.name))}if(this.wideColumns.indexOf(H.name)){wideColumns.push(H.name)}},this);var F=E.length+(2*wideColumns.length);for(var D=E.length-1;D>=0;D--){var B=E[D];if(this.narrowColumns.indexOf(B.id)>-1){Ext.applyIf(B,{width:30})}else{if(this.wideColumns.indexOf(B.id)>-1){Ext.applyIf(B,{width:200})}else{Ext.applyIf(B,{width:100})}}}return E},buildColumn:function(A){var A=A||{};if(typeof(A)=="string"){A={name:A}}return Ext.applyIf(A,{id:A.name,header:A.name.replace(/_/g," ").titleize(),sortable:true,dataIndex:A.name})},buildTopToolbar:function(){this.addButton=new Ext.Button({text:"New "+this.model.prototype.singularHumanName,scope:this,iconCls:"add",handler:this.onAdd});this.editButton=new Ext.Button({text:"Edit selected",scope:this,iconCls:"edit",disabled:true,handler:this.onEdit});this.deleteButton=new Ext.Button({text:"Delete selected",disabled:true,scope:this,iconCls:"delete",handler:this.onDelete});this.getSelectionModel().on("selectionchange",function(A){if(A.getCount()>0){this.deleteButton.enable();this.editButton.enable()}else{this.deleteButton.disable();this.editButton.disable()}},this);return[this.addButton,"-",this.editButton,"-",this.deleteButton]},buildBottomToolbar:function(A){var B=new this.model({});return new Ext.PagingToolbar({store:A,displayInfo:true,pageSize:25,emptyMsg:String.format("No {0} to display",this.model.prototype.pluralHumanName)})},onAdd:function(){this.fireEvent("add")},onEdit:function(B){var A=this.getSelectionModel().getSelected();if(A){this.fireEvent("edit",A)}},onDelete:function(){Ext.Msg.confirm("Are you sure?",String.format("Are you sure you want to delete this {0}?  This cannot be undone.",this.model.prototype.modelName.titleize()),function(A){if(A=="yes"){var B=this.getSelectionModel().getSelected();if(B){this.fireEvent("delete",B)}}},this)}});Ext.reg("scaffold_index",ExtMVC.view.scaffold.Index);ExtMVC.view.scaffold.New=Ext.extend(ExtMVC.view.scaffold.ScaffoldFormPanel,{initComponent:function(){Ext.applyIf(this,{title:"New "+this.model.prototype.singularHumanName});ExtMVC.view.scaffold.New.superclass.initComponent.apply(this,arguments)}});Ext.reg("scaffold_new",ExtMVC.view.scaffold.New);ExtMVC.view.scaffold.Edit=Ext.extend(ExtMVC.view.scaffold.ScaffoldFormPanel,{initComponent:function(){Ext.applyIf(this,{title:"Edit "+this.model.prototype.singularHumanName});ExtMVC.view.scaffold.Edit.superclass.initComponent.apply(this,arguments)},loadRecord:function(A){this.instance=A;this.getForm().loadRecord(A)},onSave:function(){this.fireEvent("save",this.instance,this.getForm().getValues())}});Ext.reg("scaffold_edit",ExtMVC.view.scaffold.Edit);ExtMVC.view.HasManyEditorGridPanel=Ext.extend(Ext.grid.EditorGridPanel,{initComponent:function(){Ext.applyIf(this,{autoScroll:true,store:this.association.findAll(),viewConfig:{forceFit:true}});if(this.hasTopToolbar){this.addTopToolbar()}ExtMVC.view.HasManyEditorGridPanel.superclass.initComponent.apply(this,arguments);this.on("afteredit",function(A){A.record.save({success:function(){A.record.commit()}})},this);this.getSelectionModel().on("selectionchange",function(A,B){if(this.deleteButton){this.deleteButton.enable()}},this)},hasTopToolbar:true,hasNewButton:true,hasDeleteButton:true,addTopToolbar:function(B){var A=[];if(this.hasNewButton){this.newButton=new Ext.Toolbar.Button({iconCls:"add",text:"Add",scope:this,handler:this.onAdd});A.push(this.newButton);A.push("-")}if(this.hasDeleteButton){this.deleteButton=new Ext.Toolbar.Button({text:"Remove selected",disabled:true,iconCls:"delete",scope:this,handler:this.onDelete});A.push(this.deleteButton)}Ext.applyIf(this,{tbar:A})},windowConfig:{},onAdd:function(A){if(!this.addWindow){this.addWindow=new Ext.Window(Ext.applyIf(this.windowConfig,{title:"New",layout:"fit",modal:true,height:300,width:400,items:[this.form],closeAction:"hide",buttons:[{text:"Save",iconCls:"save",scope:this,handler:this.onSaveNew},{text:"Cancel",iconCls:"cancel",scope:this,handler:this.onCancelNew}]}))}this.addWindow.show()},onDelete:function(B){var A=this.getSelectionModel().selection.record;if(A){A.destroy({scope:this,success:function(){this.store.reload()},failure:function(){Ext.Msg.alert("Delete failed","Something went wrong while trying to delete - please try again");this.store.reload()}})}this.deleteButton.disable()},onSaveNew:function(){this.association.create(this.form.getForm().getValues(),{scope:this,success:function(B,A){this.store.reload();this.addWindow.hide()},failure:function(B,A){this.form.getForm().clearInvalid();this.form.getForm().markInvalid(B.errors.forForm())}})},onCancelNew:function(A){this.addWindow.hide()}});Ext.reg("hasmany_editorgrid",ExtMVC.view.HasManyEditorGridPanel);